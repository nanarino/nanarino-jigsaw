<title>JIGSAW 4*4</title>
<link rel="icon" type="image/svg+xml" href="/jigsaw/assets/logo-123b04bc.svg">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
<style>body{margin:0;padding:0}#jigsawview{box-sizing:content-box;position:relative;margin:0 auto;background-color:black}.jigsaw{box-sizing:content-box;border:2px solid black;position:absolute;transition:.4s;z-index:2}#jigsaw33{box-sizing:content-box;border-color:transparent;opacity:.2;z-index:1}img{width:100%;height:100%}#Controller{box-sizing:content-box;position:absolute;top:313px;left:313px;width:110px;height:110px;padding:20px;border-radius:50%;background-color:lightpink;z-index:3}p{box-sizing:content-box;margin-top:20px;margin-left:10px}button{box-sizing:content-box;position:absolute;top:81px;left:51px}</style>
<div id="jigsawview" ondragstart="return false"><div id='jigsaw00' class="jigsaw"></div><div id='jigsaw01' class="jigsaw"></div><div id='jigsaw02' class="jigsaw"></div><div id='jigsaw03' class="jigsaw"></div><div id='jigsaw10' class="jigsaw"></div><div id='jigsaw11' class="jigsaw"></div><div id='jigsaw12' class="jigsaw"></div><div id='jigsaw13' class="jigsaw"></div><div id='jigsaw20' class="jigsaw"></div><div id='jigsaw21' class="jigsaw"></div><div id='jigsaw22' class="jigsaw"></div><div id='jigsaw23' class="jigsaw"></div><div id='jigsaw30' class="jigsaw"></div><div id='jigsaw31' class="jigsaw"></div><div id='jigsaw32' class="jigsaw"></div><div id='jigsaw33' class="jigsaw"></div><div id='Controller'><p>Are you Ok ?</p><button id="btn">start</button></div></div>
<script>const shuffle=arr=>{const len=arr.length;for(let i=0;i<len-1;i++){let idx=Math.floor(Math.random()*(len-i));let temp=arr[idx];arr[idx]=arr[len-i-1];arr[len-i-1]=temp}return arr};const isValid=arr=>{let count=0,len=arr.length;for(let i=0;i<len;i++){for(let j=i+1;j<len;j++){if(arr[j]<arr[i]){count++}}}return count%2===0};window.onload=()=>{const jigsawW=Math.min((window.innerWidth/4-2.5)|0,194);jigsawview.style.height=(4*jigsawW+2)+'px';jigsawview.style.width=(4*jigsawW+2)+'px';Controller.style.left=(2*jigsawW-75)+'px';Controller.style.top=(2*jigsawW-75)+'px';Controller.style.display="none";let detime=0,imgpath="<img src='/jigsaw/img"+~~(Math.random()*3)+"/img";const pstArr=(new Array(16).fill()).map((i,j)=>('0'+j.toString(4)).slice(-2));const last=window.jigsaw33;const jigsawInit=i=>{const thisJigsaw=window['jigsaw'+i];thisJigsaw.style.height=(jigsawW-2)+'px';thisJigsaw.style.width=(jigsawW-2)+'px';thisJigsaw['pro']=new Proxy(thisJigsaw,{set(target,key,value,proxy){if(key==='pst'){target.style.top=value[0]*jigsawW+'px';target.style.left=value[1]*jigsawW+'px'}return Reflect.set(target,key,value,proxy)}});thisJigsaw.pro.pst=i;thisJigsaw.innerHTML=imgpath+i+".jpg'/>";return thisJigsaw};const isWin=()=>{for(let i of pstArr){if(window['jigsaw'+i].pst!==i)return}Controller.style.display="block";Controller.innerHTML=`<p>Nice! ${((new Date()-r)/1000)|0}s</p><button onclick='history.go(0)'>restart</button>`};for(let i of pstArr){jigsawInit(i).onclick=function(){if(detime===1){Controller.style.display="block"}if([10,-10,1,-1].indexOf(last.pst-this.pst)!==-1){detime++;[this.pro.pst,last.pro.pst]=[last.pst,this.pst];window.r&&isWin()}else if(i!=='33'){this.style.opacity=0.3;last.style.opacity=1;const that=this;setTimeout(()=>{that.style.opacity=1;last.style.opacity=0.2},250)}}}btn.onclick=()=>{btn.onclick=null;Controller.style.display="none";let newPstArr=[...pstArr],allpromise=[];newPstArr.pop();do{newPstArr=shuffle(newPstArr)}while(!isValid(newPstArr));newPstArr.push('33');for(let[i,v]of Object.entries(newPstArr)){let thisJigsaw=window['jigsaw'+pstArr[i]];allpromise.push(new Promise((resolve,reject)=>{setTimeout(()=>{thisJigsaw.pro.pst='00';resolve([thisJigsaw,v])},100*i)}))}Promise.all(allpromise).then(res=>{allpromise=[];for(let i of res){allpromise.push(new Promise((resolve,reject)=>{setTimeout(function(){i[0].pro.pst=i[1]},100*(20-pstArr.indexOf(i[1])))}))}});Promise.all(allpromise).then(res=>{new Promise((resolve,reject)=>{setTimeout(()=>{window.r=new Date()})})})}}</script>